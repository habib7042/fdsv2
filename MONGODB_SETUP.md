# MongoDB рж╕рзЗржЯржЖржк ржЧрж╛ржЗржб

## ЁЯУЛ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржкржжржХрзНрж╖рзЗржк

### рзз. MongoDB ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи

#### **рж▓рзЛржХрж╛рж▓ MongoDB ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи:**

**Ubuntu/Debian:**
```bash
sudo apt update
sudo apt install mongodb
sudo systemctl start mongodb
sudo systemctl enable mongodb
```

**CentOS/RHEL:**
```bash
sudo yum install mongodb-server
sudo systemctl start mongod
sudo systemctl enable mongod
```

**macOS (Homebrew):**
```bash
brew install mongodb-community
brew services start mongodb-community
```

**Windows:**
1. [MongoDB Community Server ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзБржи](https://www.mongodb.com/try/download/community)
2. ржЗржирж╕рзНржЯрж▓рж╛рж░ ржЕржирзБрж╕рж░ржг ржХрж░рзБржи
3. MongoDB рж╕рж╛рж░рзНржнрж┐рж╕ рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рзБржи

#### **MongoDB Atlas (Cloud):**

1. [MongoDB Atlas ржП ржпрж╛ржи](https://www.mongodb.com/cloud/atlas)
2. ржлрзНрж░рж┐ ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯ рждрзИрж░рж┐ ржХрж░рзБржи
3. ржирждрзБржи ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ рждрзИрж░рж┐ ржХрж░рзБржи (ржлрзНрж░рж┐ ржЯрж┐ржпрж╝рж╛рж░ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи)
4. ржбрж╛ржЯрж╛ржмрзЗржЗржЬ ржЗржЙржЬрж╛рж░ рждрзИрж░рж┐ ржХрж░рзБржи
5. ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ рж╕рзЗржЯ ржХрж░рзБржи (0.0.0.0/0 рж╕ржХрж▓ IP ржПрж░ ржЬржирзНржп)

### рзи. Environment ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓ рж╕рзЗржЯ ржХрж░рзБржи

`.env` ржлрж╛ржЗрж▓рзЗ MongoDB URI ржпрзЛржЧ ржХрж░рзБржи:

#### **рж▓рзЛржХрж╛рж▓ MongoDB ржПрж░ ржЬржирзНржп:**
```
MONGODB_URI=mongodb://localhost:27017/fds-database
```

#### **MongoDB Atlas ржПрж░ ржЬржирзНржп:**
```
MONGODB_URI=mongodb+srv://<username>:<password>@cluster0.xxxxx.mongodb.net/fds-database?retryWrites=true&w=majority
```

### рзй. ржбрж╛ржЯрж╛ржмрзЗрж╕ рж╕рж┐ржб ржХрж░рзБржи

```bash
# MongoDB рж╕рзНржХрж┐ржорж╛ рждрзИрж░рж┐ рж╣ржмрзЗ ржЕржЯрзЛржорзЗржЯрж┐ржХ
# ржЯрзЗрж╕рзНржЯ ржбрж╛ржЯрж╛ рждрзИрж░рж┐ ржХрж░рждрзЗ:
curl -X POST http://localhost:3000/api/seed-mongo
```

## ЁЯФз ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржЪрзЗржХрж▓рж┐рж╕рзНржЯ

- [ ] MongoDB ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- [ ] MongoDB рж╕рж╛рж░рзНржнрж┐рж╕ ржЪрж▓ржЫрзЗ
- [ ] `.env` ржлрж╛ржЗрж▓рзЗ `MONGODB_URI` рж╕рзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- [ ] ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ (`mongoose`)
- [ ] ржбрж╛ржЯрж╛ржмрзЗрж╕ рж╕рж┐ржб ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ

## ЁЯЪА ржЯрзЗрж╕рзНржЯ ржХрж░рж╛рж░ ржирж┐рж░рзНржжрзЗрж╢рж╛ржмрж▓рзА

### рзз. ржбрзЗржнрзЗрж▓ржкржорзЗржирзНржЯ рж╕рж╛рж░рзНржнрж╛рж░ ржЪрж╛рж▓рзБ ржХрж░рзБржи:
```bash
npm run dev
```

### рзи. MongoDB ржнрж╛рж░рзНрж╕ржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи:

**рж╣рзЛржоржкрзЗржЬрзЗ рж▓ржЧржЗржи ржлрж░рзНржо ржЖржкржбрзЗржЯ ржХрж░рзБржи:**
```javascript
const handleLogin = async (e: React.FormEvent) => {
  e.preventDefault();
  
  try {
    const response = await fetch('/api/auth-mongo/login', { // MongoDB API ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        mobileNumber,
        pin,
        userType
      }),
    });
    
    // ... rest of the code
  } catch (error) {
    console.error('Login error:', error);
    alert("рж╕рж╛рж░рзНржнрж╛рж░рзЗ рж╕ржВржпрзЛржЧ ржХрж░рж╛ ржпрж╛ржпрж╝ржирж┐");
  }
};
```

**рж░рж╛ржЙржЯрж┐ржВ ржЖржкржбрзЗржЯ ржХрж░рзБржи:**
- рж╕ржжрж╕рзНржп ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб: `/dashboard-mongo`
- рж╣рж┐рж╕рж╛ржмрж░ржХрзНрж╖ржХ ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб: `/accountant-mongo`

### рзй. ржЯрзЗрж╕рзНржЯ ржХрзНрж░рзЗржбрзЗржирж╢рж┐ржпрж╝рж╛рж▓:

**рж╣рж┐рж╕рж╛ржмрж░ржХрзНрж╖ржХ:**
- ржорзЛржмрж╛ржЗрж▓: `01500-000000`
- PIN: `1234`

**рж╕ржжрж╕рзНржп:**
- ржорзЛржмрж╛ржЗрж▓: `01712-345678`, PIN: `1234`
- ржорзЛржмрж╛ржЗрж▓: `01823-456789`, PIN: `1234`
- ржорзЛржмрж╛ржЗрж▓: `01934-567890`, PIN: `1234`

## ЁЯРЫ рж╕ржорж╕рзНржпрж╛ рж╕ржорж╛ржзрж╛ржи

### **MongoDB ржХрж╛ржирзЗржХрж╢ржи рж╕ржорж╕рзНржпрж╛:**

1. **MongoDB ржЪрж▓ржЫрзЗ ржирж╛:**
   ```bash
   # Ubuntu/Debian
   sudo systemctl status mongodb
   sudo systemctl start mongodb
   
   # macOS
   brew services list | grep mongodb
   brew services start mongodb-community
   ```

2. **ржкрзЛрж░рзНржЯ ржмрзНржпрж╕рзНржд:**
   ```bash
   # ржкрзЛрж░рзНржЯ ржЪрзЗржХ ржХрж░рзБржи
   sudo lsof -i :27017
   
   # ржнрж┐ржирзНржирж╛ ржкрзЛрж░рзНржЯ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи
   MONGODB_URI=mongodb://localhost:27018/fds-database
   ```

3. **ржЕржерзЗржиржЯрж┐ржХрзЗрж╢ржи рж╕ржорж╕рзНржпрж╛ (Atlas):**
   - ржЗржЙржЬрж╛рж░ржирзЗржо ржПржмржВ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржЪрзЗржХ ржХрж░рзБржи
   - IP рж╣рзЛржпрж╝рж╛рж╛ржЗржЯрж▓рж┐рж╕рзНржЯ ржЪрзЗржХ ржХрж░рзБржи
   - ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржЪрзЗржХ ржХрж░рзБржи

### **ржХрзЛржб рж╕ржорж╕рзНржпрж╛:**

1. **ржоржбрзЗрж▓ ржЗржорзНржкрзЛрж░рзНржЯ рж╕ржорж╕рзНржпрж╛:**
   ```typescript
   import { connectToMongoDB } from '@/lib/mongodb';
   import { Member, Deposit, Accountant } from '@/models';
   ```

2. **ржЯрж╛ржЗржк рж╕ржорж╕рзНржпрж╛:**
   ```typescript
   // ObjectId ржХрзЗ string ржП ржХржиржнрж╛рж░рзНржЯ ржХрж░рзБржи
   const memberId = member._id.toString();
   ```

## ЁЯУК ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржЯрж┐ржкрж╕

### **ржЗржиржбрзЗржХрзНрж╕рж┐ржВ:**
MongoDB рж╕рзНржХрж┐ржорж╛рждрзЗ ржЗрждрж┐ржоржзрзНржпрзЗржЗ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржЗржиржбрзЗржХрзНрж╕ ржпрзЛржЧ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ:
- `mobileNumber` (unique)
- `nationalId` (unique)
- `memberId, month, year` (compound unique)

### **ржХрзЛржпрж╝рзЗрж░рж┐ ржЕржкрзНржЯрж┐ржорж╛ржЗржЬрзЗрж╢ржи:**
```javascript
// ржнрж╛рж▓рзЛ ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕рзЗрж░ ржЬржирзНржп
const members = await Member.find({ isActive: true })
  .select('name mobileNumber totalDeposits')
  .sort({ joinedAt: -1 })
  .lean();
```

## ЁЯФТ рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ ржмрзЗрж╕рзНржЯ ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕

1. **Environment Variables:** ржХржЦржиржЗ `.env` ржлрж╛ржЗрж▓ ржХржорж┐ржЯ ржХрж░ржмрзЗржи ржирж╛
2. **Connection Security:** ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗ SSL/TLS ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи
3. **Input Validation:** рж╕ржХрж▓ ржЗржиржкрзБржЯ ржнрзНржпрж╛рж▓рж┐ржбрзЗржЯ ржХрж░рзБржи
4. **Error Handling:** рж╕ржарж┐ржХ ржПрж░рж░ рж╣рзНржпрж╛ржирзНржбрж▓рж┐ржВ ржХрж░рзБржи
5. **Rate Limiting:** API рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ рж▓рж┐ржорж┐ржЯ ржХрж░рзБржи

## ЁЯЪА ржбрж┐ржкрзНрж▓ржпрж╝ржорзЗржирзНржЯ

### **Vercel:**
1. Environment Variables рж╕рзЗржЯ ржХрж░рзБржи
2. MongoDB Atlas URI ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи
3. ржбрж┐ржкрзНрж▓ржпрж╝ ржХрж░рзБржи

### **Heroku:**
```bash
heroku config:set MONGODB_URI=mongodb+srv://...
git push heroku main
```

### **Docker:**
```dockerfile
FROM node:18-alpine
COPY . .
RUN npm install
EXPOSE 3000
CMD ["npm", "run", "dev"]
```

## ЁЯУЮ рж╕рж╛ржкрзЛрж░рзНржЯ

ржХрзЛржирзЛ рж╕ржорж╕рзНржпрж╛ рж╣рж▓рзЗ:
1. MongoDB рж▓ржЧ ржЪрзЗржХ ржХрж░рзБржи
2. ржХрж╛ржирзЗржХрж╢ржи ржЯрзЗрж╕рзНржЯ ржХрж░рзБржи
3. ржПрж░рж░ ржорзЗрж╕рзЗржЬ рж░рж┐ржнрж┐ржЙ ржХрж░рзБржи
4. ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржи ржлрж▓рзЛ ржХрж░рзБржи